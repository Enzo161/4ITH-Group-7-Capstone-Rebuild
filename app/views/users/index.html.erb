<div class="container">
    <h1>User Management</h1>
    <!-- Search Start -->
    <div>
        <%= search_form_for @q do |f|%>
        <div class="row">
            <div class="col">
                <%= f.label "First Name" %>:
                <%= f.search_field :first_name_cont , placeholder: "Search First Name", class:'form-control' %>
                <div style="float: left ; margin-top: 10px; margin-bottom: 20px ;">
                    <%= link_to "User Invite", new_user_invitation_path, class:" btn btn-outline-primary float-end" %>
                </div>
            </div>
            <div class="col">
                <%= f.label "Last Name" %>:
                <%= f.search_field :last_name_cont , placeholder: "Search First Name", class:'form-control' %>
            </div>
            <div class="col">
                <%= f.label :email_cont %>:
                <%= f.search_field :email_cont , placeholder: "Search Email", class:'form-control' %>
                <div style="float: right; margin-top: 10px; margin-bottom: 20px ;">
                    <%= f.submit "Search", class: 'btn btn-outline-primary ' %>
                    <%= link_to "Reset Search", request.path, class:"btn btn-light " %>
                </div>
            </div>
        </div>
        <div>
        </div>
        <% end %>
    </div>
    <!-- Search End -->
    <table class="table table-hover table-bordered">
        <thead>
            <tr>
                <th>
                    <%= sort_link(@q, :first_name, "Name", default_order: :asc)%>
                </th> <!-- Sorts through the names in alphabetical order-->
                <th>
                    <%= sort_link(@q, :email, "Email", default_order: :asc)%>
                </th>
                <th>
                    <%= sort_link(@q, :role, "Role", default_order: :asc)%>
                </th>
                <th>Account Status</th>
                <th>Delete</th>
                <% if current_user.role == "super admin" %>
                <th>Change Role</th>
                <% end %>
            </tr>
        </thead>
        <tbody>
            <% @users.each do |user| %>
            <tr>
                <td>
                    <% if user.first_name == nil || user.last_name == nil %>
                    <p class="text-break"> Not set by user <p>
                            <% else %>
                            <p>
                                <%= user.first_name %>
                                <%= user.last_name %>
                            </p>
                            <% end %>
                </td>
                <td>
                    <p class="text-break">
                        <%= user.email %>
                    </p>
                </td>
                <td>
                    <p class="text-break">
                        <% if user.role == "admin" %>
                        Admin
                        <% elsif user.role == "super admin" %>
                        Super Admin
                        <% else %>
                        User
                        <% end %>
                    </p>
                </td>
                <td>
                    <% if user.created_by_invite? && user.invitation_accepted? == false %>
                    <%= button_to 'Waiting for activation, Resend invitation?', resend_invitation_user_path(user), method: :patch, class:"btn btn-outline-warning text-wrap", style:"width: auto" %>
                    <% else %>
                    <p style="color:green">Account is active</p>
                    <% end %>
                </td>
                <td>
                    <div class="position-relative">
                        <% if current_user.role == "super admin" && current_user.email != user.email %>
                        <%= button_to 'delete user', user, class:"btn btn-outline-danger", style:"width: 100%", method: :delete, data: { confirm: 'Are you sure?' } %>
                        <% elsif current_user.email != user.email && user.role != "admin"%>
                        <%= button_to 'delete user', user, class:"btn btn-outline-danger", style:"width: 100%", method: :delete, data: { confirm: 'Are you sure?' } %>
                        <% elsif current_user.email == user.email %>
                        <div class="text-center">
                            <p style="color:green">Current Account</p>
                        </div>
                        <% else %>
                        <div class="text-center">
                            <p style="color:orange">Cannot be Deleted</p>
                        </div>
                        <% end %>
                    </div>
                </td>
                <% if current_user.role == "super admin" %>
                <td>
                    <% if user.role == "user" %>
                    <%= button_to "Promote to admin", promote_user_path(user), class:"btn btn-outline-primary", style:"width: 100%", method: :post %>
                    <% elsif user.role == "admin" %>
                    <%= button_to "Demote to user", demote_user_path(user), class:"btn btn-outline-secondary", style:"width: 100%", method: :post %>
                    <% elsif current_user.email == user.email %>
                    <div class="text-center">
                        <p style="color:green">Current Account</p>
                    </div>
                    <% end %>
                </td>
                <% end %>
            </tr>
            <% end %>
        </tbody>
    </table>